# Firestore Data Schema

```lisp
users (collection)
├── user_id (document)
│   ├── username: <string>
│   ├── pfp: <string_url>
│   ├── total_comment_generations: <int>
│   ├── total_gen_requests: <int>
│   ├── created_at: <timestamp>
│   ├── last_login: <timestamp>
│   └── products (subcollection)
│       ├── product_id (document)
│       │   ├── url: <string_url>
│       │   ├── product_name: <string>
│       │   ├── description: <string>
│       │   ├── total_comment_generations: <int>
│       │   ├── total_gen_requests: <int>
│       │   ├── est_price: <double>
│       │   ├── last_updated: <timestamp>
│       │   └── gen_requests (subcollection)
│       │       ├── request_id (document)
│       │       │   ├── request_id: <string>
│       │       │   ├── num_comments_requested: <int>
│       │       │   ├── num_comments_generated: <int>
│       │       │   ├── pollution_level: <string>
│       │       │   ├── num_exports: <int>
│       │       │   ├── status: <string-enum>
│       │       │   ├── request_timestamp: <timestamp>
│       │       │   ├── completion_timestamp: <timestamp>
│       │       │   ├── model_version: <string>
│       │       │   └── generated_comments (subcollection)
│       │       │       ├── comment_id (document)
│       │       │       │   ├── comment: <string>
│       │       │       │   ├── relevancy_score: <double>
│       │       │       │   ├── offensivity_score: <double>
│       │       │       │   └── timestamp: <timestamp>
```

_commend_id_ stored as document because lists are generally inefficient with scaling in a key-value DB.

## JSON Representation of DB Schema

```json
{
  "users": {
    "userID1": {
      "email": "user1@example.com",
      "username": "user1",
      "pfp": "profile_picture_url_1",
      "total_comment_generations": 100,
      "total_gen_requests": 1,
      "created_at": "2024-01-01T00:00:00Z",
      "last_login": "2024-08-07T14:56:00Z",
      "products": {
        "productID1": {
          "url": "product_url_1",
          "product_name": "Sample Product",
          "description": "This is a sample product description generated by LLM.",
          "total_comments": 50,
          "total_gen_requests": 1,
          "est_price": 100,
          "gen_requests": {
            "requestID1": {
              "request_id": "requestID1",
              "num_comments_requested": 10,
              "num_comments_generated": 10,
              "pollution_level": "HIGH",
              "num_exports": 1,
              "status": "Complete",
              "request_timestamp": "2024-08-07T12:00:00Z",
              "completion_timestamp": "2024-08-07T12:05:00Z",
              "model_version": "v1.0",
              "generated_comments": {
                "commentID1": {
                  "comment": "Great product!",
                  "relevancy_score": 9.5,
                  "offensivity_score": 0.0,
                  "timestamp": "2024-08-07T12:34:56Z"
                },
                "commentID2": {
                  "comment": "Not satisfied with the quality.",
                  "relevancy_score": 5.0,
                  "offensivity_score": 0.1,
                  "timestamp": "2024-08-07T13:45:12Z"
                }
              }
            }
          }
        }
      }
    }
  }
}
```

# Current Data Model

### **Users**
- `user_id` : string - Firebase-generated unique identifier of same value as document. Storing it within the document improves consistency, redundancy, and paves an easier path for querying.
- `username` : string - represents readable identifier of the user account, which is the user's **email address** with Google auth.
    - named username in case I add any other authentication providers which don't represent the user's email
- `pfp` : string - link to the image source URL of the user's profile picture (if any)
- `total_comment_generations` : int - indicates how many total comments the user generated
    - can be verified with SUM(products.num_comments)
- `total_generation_requests` : int - indicated how many requests the user has made
    - can be verified with COUNT(products.gen_request)
- `created_at` : Timestamp - indicated date and time when the use registered the account onto the CommentCrafter site
- `last_login` : Timestamp - track when the user last visited the site for potential analytics purposes.
- **`products`** : Subcollection - set of product documents the user produced

### **Products**
- `product_id` : string - unique identifier for product, redundancy
- `url` : string - link to the user-inputted product
- `product_name` : string - LLM-generated assumption of the product name 
- `description` : string - short LLM-generated paragraph describing the product
- `total_comments` : int - number of comments the user has generated for this specific product
    - can verify this by running SUM(gen_requests.num_comments_requested)
- `total_gen_requests` : int - number of distinct requests the user has made for this specific produc
    - can verify this but running COUNT(gen_requests)
- `est_price` : int - estimated price the product is selling for, to be utilized for comment generation
- `last_updated` : Timestamp - when this specific product was last updated (most recent gen_requett timestamp)
- **`gen_requests`** : Subcollcetion - set of generation requests the user has made for this specific product (post-URL canonicalization)

### **Gen_Request**
- `request_id` : string - unique identifier for gen_request, redundancy
- `num_comments_requested` : int - total amount of comments requested for this specific query
- `num_comments_generated` : int - total amount of comments generated for this specific query (for redundancy and assigning status value)
- `pollution_level` : string-enum - requested pollution level for the data ("LOW", "MODERATE", "HIGH")
- `status` : string-enum - current status of the request (e.g. Loading, Complete, Failed)
- `request_timestamp` : Timestamp - the timestamp at which the user made this request
- `completion_timestamp` : Timestamp - the timestamp at which the request was completed (for analytics and optimization purposes)
- `model_version` : string - version of the LLM or model used for generating the comments. This is important for tracking the evolution of model performance over time.
- `num_exports` : int - total number of times the user has exported the data for this request (to prevent potential resource abuse and for analytics)
- **`generated_comments`** - Subcollection - set of LLM-generated comments by this user for this product-link gen request


### **Generated_Comments**
- `comment` : string - LLM-generated comment text
- `relevancy_score` : double - [0,10] rating of how relevant the LLM finds this comment in relation to the product in question
- `offensivity_score` : double - [0,10] rating of how offensive the LLM finds this comment in relation to the product in question
- `timestamp` - Timestamp : date and time of the comment's generation

# Future Expansion to Data Store

Since its easy to add fields in Firebase given its schemaless nature, I will refrain from adding the below fields until I find the need to do so.

**Users**
- `preferences`
    - `req_comments`
    - `export_format`
    - `pollution_level`
- `comment_gen_limit` - for monetization and anti-spam

**Gen_Request**
- `request_source`: String - Indicates where the request was initiated from, such as a web app, mobile app, or API. This is useful for understanding how users are interacting with your service.
- `generation_parameters` : map (key-value pairs) - A set of parameters used during the comment generation process (e.g., temperature, max tokens, etc.).
  - This allows you to reproduce or adjust the generation process as needed.
- `total_tokens_generated` - the total number of tokens (words) generated in response to the request. This can help in tracking usage and cost if token-based billing is implemented.
